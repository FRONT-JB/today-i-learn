# [ 19 단계 - 컴퓨터들도 라인을 잘 타야 살아 남는다 ]

<aside>
💡 노드들이 갈림길에서 일관되게 선택하는 방법과 시스템의 개별 노드가 유지하고 있는 트랜잭션 이력이 서로 달라 충돌이 생기는 문제를 어떻게 해결하는지

</aside>

## **목표**

네트워크 내 모든 노드가 명확한 단일 트랜잭션 이력만 유지하도록 해서 어느 노드가 소유권 확인 요청을 처리하든 항상 동일한 결과가 산출되도록 하는 것

## 과제

> 네트워크의 모든 피어가 명확한 단일 트랜잭션 이력을 유지하는데의 두가지 장애

- 메시지는 분실될 수 있고 늦게 배달될 수 있고, 순서가 뒤죽박죽인 상태로 도착할 수 있다.
- 작업상태의 전환도 같은 시각에 모든 노드에게서 동일하게 일어나지 않는다.

<aside>
💡 메시지 전달 과정에 어떤 문제가 발생하더라도 중앙 통제 방식 해법에 의존하는 일 없이 명확한 단일 트랜잭션 이력을 식별하는 방법을 찾아야 한다.

</aside>

### 아이디어

> 각 노드는 자신의 수신함에 도착한 메시지에 따라 두 작업 사이를 개별적으로 전환한다.

이 독립적인 행동을 하는 개인들로 구성된 군중이 집단적 문제를 해결하는 상황 조건의 특징으로

1. 집단을 구성하는 독립된 개인들은 동일한 환경에서 행동
2. 집단적 의사결정이 필요한 문제가 존재
3. 개인들은 동일한 목표를 달성하기 위해 독립적으로 노력
4. 목표 달성을 위해 개인이 취한 행동은 환경에 가시적 흔적을 남겨 집단적 의사결정 문제를 결정하는 데 도움을 줌
5. 각 개인은 환경 변화에 기반한 동일한 기준을 사용해 의사결정 문제를 평가

### 작동원리

> 모든 노드는 트랜잭션 데이터 이력 선정을 위해 동일한 기준을 사용한다.

<aside>
💡 블록체인 데이터 구조는 일직선으로 이어진 체인이 아니라 트리나 원주형 선인장처럼 생겼다.
제일 오래된 블록은 **루트**, 자신을 가리키고 있는 블록이 없는 경우 **잎**이라고 부른다.
**루트블록부터 잎 블록까지** 순서대로 연결된 고리를 **경로**라고 부른다.

</aside>

**`가장 긴 체인 기준`**

각 노드가 트리  모양 블록체인  데이터  구조 중 **가장 많은 블록을 가진 경로**를 개별적으로 선택하는 것

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/18fa6923-b24c-4058-b06d-5073ba8225f2/Untitled.png)

<aside>
💡 메시지 전달의 지연, 동시의 작업증명 으로 인해 발생한 가지노드
1. AB12 노드와 DD01 노드,  BB11 노드와, CCC1 노드
( 체인의 길이가 같은 경우 각 노드는 어느 쪽 가지를 확장할지 임의로 정한다. )

</aside>

`**가장 무거운 체인 기준**`

각 노드가 트리  모양 블록체인  데이터  구조 중 **난이도 합산이 가장 큰 경로**를 개별적으로 선택하는 것

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4de5fd98-4293-4a38-aa47-d4d958cfce15/Untitled.png)

<aside>
💡 블록헤더에 난이도 값이 존재하므로 **경로의 누적 난이도를 가중치**라 부른다.
**가장 긴체인의 가중치는 5**이고, **두번째로 긴 체인의 가중치는 6**이다.

</aside>

**선택받지 못한 체인은 어떻게 될까?**

![Untitled](https://s3-us-west-2.amazonaws.com/secure.notion-static.com/4de5fd98-4293-4a38-aa47-d4d958cfce15/Untitled.png)

- 고아 블록
  - 권위 체인경로에 속하지 않은 블록
  - 가장 긴 체인 기준 - DD01, CCC1
  - 가장 무거운 체인 기준 - 0101, BB11, DD01
- 보상 회수
  - 쓸모없는 것으로 판명되면 그 불록은 물론 후속 블록 모두 논리적으로 제거
  - 그 블록을 추가하면서 보상을 받은 노드에게서 보상을 회수
- 소유권 명확화
  - 권위체인에 속한 트랜잭션만 인정받아 소유권 명확화
  - 고아블록은 마치 발생한 적이 없었던 것처럼 간주
- 트랜잭션 재처리
  - 고아 블록에 소속돼 버려진 트랜잭션은 다시 노드의 수신함에 넘겨져 재처리
  - 잠시 사라지게 되지만 재처리가 되자마자 다시 나타남
- 공통 몸통의 성장
  -
- 궁극적 일관성
  - 시간이 지나 더 많은 블록이 추가될수록 권위 체인에 포함될 가능성이 높아지는 현상을 궁극적 일관성이라고 함
- 조작에 대한 견고성
  - 계산 노력이 가장 많이 들어간 경로가 권위있는 버전이다
  - 공격자가 내부 블록을 조작하려면 작업증명을 다시 해야 하고, 모든 후속 블록의 해시 퍼즐을 다시 풀어서 정직한 노드들이 유지하고 있던 경로를 따라잡아야 한다.

## 51% 공격

51% 공격은 대다수의 동의를 얻거나 통제하려는 시도를 통해 권위 체인의 블록 일부를 고아 블록으로 만들고, 트랜잭션 데이터의 새로운 권위 체인을 만들어 공격자에게 혜택이 돌아가도록 조작된 소유권 정보를 배부하려고 하는 것을 의미한다.

- 51% 공격은 다음과 같은 특징을 가지고 있다.
  - 경제적 측면: 집단적 트랜잭션 이력을 변경하여 소유권 할당을 바꿈
  - 의사결정 측면: 원하는 결과를 얻기 위해 대다수의 표를 모음
  - 기술적 측면: 시스템 무결성을 약화시킴
  - 구조적 측면: 숨겨진 중앙 통제 요소를 일정 시간 이상 생성시켜 시스템의 상태를 변경
